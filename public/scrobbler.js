var last_track;var now_playing;var seconds_counter;function scrobbler(fromuser) {	$.getJSON('http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=' + encodeURIComponent(fromuser) + '&format=json&api_key=f4ed6789842316ebb3a91e3247946c8b&limit=1&callback=?',	function(data){		$('#loading').remove();		$.each(data.recenttracks.track, function(i, item) {								if (typeof(item['@attr']) !== 'undefined') {				if (last_track !== item.url) {					$('#now_playing_song').html('<big><b><a href="' + item.url + '" target="_new" class="track">' + item.name + '</a></b></big><br>by ' + item.artist['#text']);					$('#not_playing').hide();					$('#now_playing').show();					$('#scrobbled').hide();					$('#scrobble_countdown').show();											var seconds = parseInt($("#countdown").text()) - 10;					$("#countdown").text(seconds);					if (seconds < 2) {											last_track = item.url;						$('#scrobble_countdown').hide();						$('#scrobbling').show();						$.ajax({  							type: "POST",  							url: "/scrobble",  							data: 'artist=' + encodeURIComponent(item.artist['#text']) + '&song=' + encodeURIComponent(item.name),							success: function() {								$('#scrobbling').hide();								$('#scrobbled').show();								$("#countdown").text(50);							}						});					} else if (now_playing !== item.url) {						now_playing = item.url;						$("#scrobble_countdown").hide();						$("#scrobble_request").show();											$.ajax({							type: "POST",							url: "/now_playing",							data: 'artist=' + encodeURIComponent(item.artist['#text']) + '&song=' + encodeURIComponent(item.name),							success: function(data) {								$("#countdown").text(Math.round(data.duration / 1000 / 2));								$("#scrobble_countdown").show();								$("#scrobble_request").hide();							}						});						}				}							} else {			    $('#now_playing').hide();			    $('#not_playing').show();			}			return false;		});	});}function bind_form() {		$('form').submit(function(event) {				event.preventDefault();				$('input.start').val('checking username...');				$.getJSON('http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=' + encodeURIComponent($('#fromuser').val()) + '&format=json&api_key=f4ed6789842316ebb3a91e3247946c8b&limit=1&callback=?', 			function(data){				if (data.error) {					$('input.start').val('authorize and start scrobbling');					$('input#fromuser').addClass('error');					$('label#label_fromuser').addClass('error');					$('p.error').text('User not found!');				} else {					$('input.start').val('authorizing...');					$('form').unbind('submit').submit();				}			});		});}